<!-- patients.html -->
<div class="patients-container">
  <app-shared-header [userType]="'doctor'" [userName]="doctorName"></app-shared-header>

  <main class="patients-main">
    <!-- Page Header -->
    <section class="page-header">
      <h1 class="page-title">Patient Directory</h1>
      <p class="page-subtitle">Manage and view all your patients</p>
    </section>

    <!-- Search Bar -->
    <section class="search-filter-section">
      <div class="search-bar">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="search-icon">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.35-4.35"/>
        </svg>
        <input 
          type="text" 
          placeholder="Search patients by name or condition..." 
          [(ngModel)]="searchQuery"
          class="search-input"
        >
      </div>
      <button class="filter-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
        </svg>
        Filters
      </button>
    </section>

    <!-- Patients List -->
    <section class="patients-list">
      <div 
        class="patient-card" 
        *ngFor="let patient of patients | filter: searchQuery:'name':'condition'"
        [routerLink]="['/doctor-patients', patient.id]"
      >
        <div class="patient-info">
          <div class="avatar">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
              <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
          </div>
          <div class="details">
            <h3 class="patient-name">{{ patient.name }}</h3>
            <p class="patient-meta">{{ patient.age }} years old â€¢ {{ patient.gender }}</p>
            <div class="patient-info-row">
              <span class="info-tag">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                </svg>
                {{ patient.condition }}
              </span>
              <span class="info-tag">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect width="18" height="18" x="3" y="4" rx="2" ry="2"/>
                  <line x1="16" x2="16" y1="2" y2="6"/>
                  <line x1="8" x2="8" y1="2" y2="6"/>
                  <line x1="3" x2="21" y1="10" y2="10"/>
                </svg>
                Last Visit: {{ patient.lastVisit }}
              </span>
            </div>
          </div>
        </div>

        <div class="actions">
          <span class="status-badge" [ngClass]="getStatusClass(patient.status)">
            {{ patient.status }}
          </span>
          <div class="buttons">
            <button class="btn-secondary" (click)="viewRecords(patient.id); $event.stopPropagation()">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              View Records
            </button>
            <button class="btn-primary" (click)="messagePatient(patient.id); $event.stopPropagation()">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
              </svg>
              Message
            </button>
          </div>
        </div>


 <!-- Message Modal -->
<div class="modal-overlay" *ngIf="showMessageModal" (click)="closeMessageModal()">
  <div class="modal-content message-modal" (click)="$event.stopPropagation()">

    <div class="modal-header">
      <div>
        <h3 class="modal-title">Message {{ selectedPatient?.name }}</h3>
        <p class="modal-subtitle">Last Visit: {{ selectedPatient?.lastVisit }}</p>
      </div>
      <button class="btn-close" (click)="closeMessageModal()">Ã—</button>
    </div>

    <div class="modal-body">

      <!-- Preview Messages (static mockup or you can remove) -->
      <div class="message-preview">
        <div class="preview-message received">
          <p>Hello, doctor!</p>
          <span class="message-time">Yesterday, 3:45 PM</span>
        </div>
      </div>

      <!-- Input -->
      <div class="message-input-area">
        <button class="btn-attach">ðŸ“Ž</button>
        <input 
          type="text"
          placeholder="Type your message..."
          [(ngModel)]="messageText"
          (keyup.enter)="sendMessage()"
          class="message-input"
        >
        <button class="btn-send" (click)="sendMessage()">âž¤</button>
      </div>

      <p class="encryption-notice">
        ðŸ”’ End-to-end encrypted messaging
      </p>

    </div>

  </div>
</div>


      </div>
    </section>

    <router-outlet></router-outlet>
  </main>
</div>