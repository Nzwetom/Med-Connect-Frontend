<!-- patient-detail.html -->
<div class="patient-detail-container">
  <app-shared-header [userType]="'doctor'"></app-shared-header>

  <main class="detail-main">
    <!-- Back Button -->
    <button class="btn-back" (click)="cancel()">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="19" x2="5" y1="12" y2="12"/>
        <polyline points="12 19 5 12 12 5"/>
      </svg>
      Back to Patients
    </button>

    <!-- Layout Grid -->
    <div class="layout">
      <!-- Left Sidebar -->
      <aside class="patient-sidebar">
        <!-- Profile Card -->
<div class="profile-card" *ngIf="patient">
  <div class="avatar-large">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
      <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
      <circle cx="12" cy="7" r="4"/>
    </svg>
  </div>
  <h2 class="patient-name-large">{{ patientName }}</h2>
  <span class="status-badge status-active">Active</span>

  <div class="info-grid">
    <div class="info-item">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect width="18" height="18" x="3" y="4" rx="2" ry="2"/>
        <line x1="16" x2="16" y1="2" y2="6"/>
        <line x1="8" x2="8" y1="2" y2="6"/>
        <line x1="3" x2="21" y1="10" y2="10"/>
      </svg>
      <div>
        <span class="label">Date of Birth</span>
        <strong>{{ formatDate(patient.dateOfBirth) }}</strong>
      </div>
    </div>
    <div class="info-item">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
      </svg>
      <div>
        <span class="label">Blood Type</span>
        <strong>{{ patient.bloodType || 'N/A' }}</strong>
      </div>
    </div>
    <div class="info-item">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
      </svg>
      <div>
        <span class="label">Phone</span>
        <strong>{{ patient.phone || 'N/A' }}</strong>
      </div>
    </div>
    <div class="info-item">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect width="20" height="16" x="2" y="4" rx="2"/>
        <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
      </svg>
      <div>
        <span class="label">Email</span>
        <strong>{{ patient.email }}</strong>
      </div>
    </div>
  </div>
</div>

<!-- Allergies Card with helper getter -->
<div class="allergies-card" *ngIf="hasAllergies">
  <h3 class="card-title">
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"/>
      <line x1="12" x2="12" y1="8" y2="12"/>
      <line x1="12" x2="12.01" y1="16" y2="16"/>
    </svg>
    Allergies
  </h3>
  <div 
    *ngFor="let allergy of patient!.allergies" 
    class="allergy"
    [ngClass]="{
      'severe': allergy.severity === 'severe',
      'moderate': allergy.severity === 'moderate',
      'mild': allergy.severity === 'mild'
    }">
    <div>
      <strong>{{ allergy.name }}</strong>
      <small>{{ allergy.reaction }}</small>
    </div>
    <span class="severity-badge">{{ allergy.severity | titlecase }}</span>
  </div>
</div>
        <!-- Action Buttons -->
        <button class="action-btn message-btn" (click)="openMessageModal()">
  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
  </svg>
  Send Message
</button>
        <!-- <button class="action-btn schedule-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect width="18" height="18" x="3" y="4" rx="2" ry="2"/>
            <line x1="16" x2="16" y1="2" y2="6"/>
            <line x1="8" x2="8" y1="2" y2="6"/>
            <line x1="3" x2="21" y1="10" y2="10"/>
          </svg>
          Schedule Appointment
        </button> -->

        <!-- Message Modal -->
<div class="modal-overlay" *ngIf="showMessageModal" (click)="closeMessageModal()">
  <div class="modal-content message-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div>
        <h3 class="modal-title">Message John Smith</h3>
        <p class="modal-subtitle">Patient</p>
      </div>
      <button class="btn-close" (click)="closeMessageModal()">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" x2="6" y1="6" y2="18"/>
          <line x1="6" x2="18" y1="6" y2="18"/>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <div class="message-preview">
        <div class="preview-message received">
          <p>Hello Doctor, thank you for the last consultation.</p>
          <span class="message-time">Yesterday, 3:45 PM</span>
        </div>
        <div class="preview-message sent">
          <p>You're welcome! How are you feeling today?</p>
          <span class="message-time">Yesterday, 4:02 PM</span>
        </div>
      </div>

      <!-- Attached File Display -->
      <div class="attached-file" *ngIf="attachedFile">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="file-icon">
          <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
          <polyline points="14 2 14 8 20 8"/>
        </svg>
        <div class="file-info">
          <span class="file-name">{{ attachedFile.name }}</span>
          <span class="file-size">{{ formatFileSize(attachedFile.size) }}</span>
        </div>
        <button type="button" class="btn-remove-file" (click)="removeAttachment()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>

      <div class="message-input-area">
        <button class="btn-attach" (click)="triggerFileInput()" type="button">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
          </svg>
        </button>
        <input 
          type="text" 
          placeholder="Type your message..."
          [(ngModel)]="messageText"
          (keyup.enter)="sendMessage()"
          class="message-input"
        >
        <!-- Hidden File Input -->
        <input 
          type="file" 
          #fileInput
          class="file-input-hidden" 
          (change)="onFileSelected($event)"
          accept=".pdf,.jpg,.jpeg,.png,.doc,.docx"
        >
        <button class="btn-send" (click)="sendMessage()" [disabled]="!messageText.trim() && !attachedFile">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="22" y1="2" x2="11" y2="13"/>
            <polygon points="22 2 15 22 11 13 2 9 22 2"/>
          </svg>
        </button>
      </div>

      <p class="encryption-notice">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect width="18" height="18" x="3" y="11" rx="2" ry="2"/>
          <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
        </svg>
        End-to-end encrypted messaging
      </p>
    </div>
  </div>
</div>




      </aside>

      <!-- Right Content -->
      <div class="patient-content">
        <!-- Tabs -->
        <div class="tabs">
          <button class="tab-btn" [class.active]="activeTab === 'vitals'" (click)="setTab('vitals')">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
            </svg>
            Vitals
          </button>
          <button class="tab-btn" [class.active]="activeTab === 'medications'" (click)="setTab('medications')">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z"/>
              <path d="m8.5 8.5 7 7"/>
            </svg>
            Medications
          </button>
          <button class="tab-btn" [class.active]="activeTab === 'history'" (click)="setTab('history')">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <polyline points="12 6 12 12 16 14"/>
            </svg>
            History
          </button>
          <button class="tab-btn" [class.active]="activeTab === 'documents'" (click)="setTab('documents')">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
              <polyline points="14 2 14 8 20 8"/>
            </svg>
            Documents
          </button>
          <button class="tab-btn" [class.active]="activeTab === 'notes'" (click)="setTab('notes')">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
            Notes
          </button>
        </div>

        <!-- Tab Content will go here based on activeTab -->
        <div class="tab-content" *ngIf="activeTab === 'vitals'">
          <!-- Vitals content from original -->
           <h3>Latest Vital Signs</h3>
        <div class="vitals-grid">
          <div class="vital"><div>Blood Pressure</div><strong>128/82 mmHg</strong><span class="normal">Normal</span></div>
          <div class="vital"><div>Heart Rate</div><strong>72 bpm</strong><span class="normal">Normal</span></div>
          <div class="vital"><div>Temperature</div><strong>98.6Â°F</strong><span class="normal">Normal</span></div>
          <div class="vital"><div>Weight</div><strong>185 lbs</strong><span class="normal">Normal</span></div>
        </div>
      
        </div>

       <!-- Medications Tab with helper getter -->
<div class="tab-content" *ngIf="activeTab === 'medications'">
  <h3>Current Medications</h3>
  <p class="subtitle">Active prescriptions and treatments</p>
  <div class="medications-list" *ngIf="hasMedications">
    <div class="medication-card" *ngFor="let med of patient!.currentMedications">
      <div class="med-name">{{ med.name }}</div>
      <div class="dosage">{{ med.dosage }} • {{ med.frequency }}</div>
      <div class="prescribed">Started: {{ formatDate(med.startDate) }}</div>
      <span class="status-active">Active</span>
    </div>
  </div>
  <p *ngIf="!hasMedications" class="empty-state">
    No medications on record
  </p>
</div>

        <div class="tab-content" *ngIf="activeTab === 'history'">
          <!-- History content from original -->
           <h3>Visit History</h3>
        <div class="history-list">
          <div class="visit-item">
            <div class="visit-date">November 10, 2025</div>
            <div class="visit-type">Follow-up Checkup â€¢ In-Person</div>
            <div class="visit-notes">Blood pressure stable. Continue current medication.</div>
          </div>
          <div class="visit-item">
            <div class="visit-date">October 15, 2025</div>
            <div class="visit-type">Annual Physical â€¢ In-Person</div>
            <div class="visit-notes">All vitals normal. Renewed prescriptions.</div>
          </div>
          <div class="visit-item">
            <div class="visit-date">September 20, 2025</div>
            <div class="visit-type">Teleconsult</div>
            <div class="visit-notes">Patient reported mild fatigue. Started Lisinopril.</div>
          </div>
        </div>
        </div>

        <div class="tab-content" *ngIf="activeTab === 'documents'">
          <!-- Documents content from original -->
        <h3>Medical Documents</h3>
        <p class="subtitle">Patient's uploaded medical records</p>
        <div class="documents-list">
          <div class="document-item">
            <div class="doc-icon">File</div>
            <div class="doc-info">
              <div class="doc-name">Chest X-Ray</div>
              <div class="doc-meta">Radiology â€¢ 2025-10-15</div>
            </div>
            <button class="download-btn">View</button>
          </div>
          <div class="document-item">
            <div class="doc-icon">File</div>
            <div class="doc-info">
              <div class="doc-name">Blood Test Results</div>
              <div class="doc-meta">Laboratory â€¢ 2025-10-15</div>
            </div>
            <button class="download-btn">View</button>
          </div>
          <div class="document-item">
            <div class="doc-icon">File</div>
            <div class="doc-info">
              <div class="doc-name">ECG Report</div>
              <div class="doc-meta">Cardiology â€¢ 2025-09-20</div>
            </div>
            <button class="download-btn">View</button>
          </div>
          <div class="document-item">
            <div class="doc-icon">File</div>
            <div class="doc-info">
              <div class="doc-name">Prescription - Lisinopril</div>
              <div class="doc-meta">Medication â€¢ 2025-09-20</div>
            </div>
            <button class="download-btn">View</button>
          </div>
        </div>

        </div>

        <div class="tab-content" *ngIf="activeTab === 'notes'">
          <!-- Notes content from original -->
        <h3>Doctor's Notes</h3>
        <p class="subtitle">Add private notes about this patient</p>
        <textarea placeholder="Enter your private notes here..." class="notes-textarea"></textarea>
        <div class="notes-actions">
          <button class="save-notes-btn">Save Notes</button>
        </div>

        </div>
      </div>
    </div>
  </main>
</div>