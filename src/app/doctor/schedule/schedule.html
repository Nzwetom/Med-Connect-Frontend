<!-- schedule.html -->
<div class="schedule-container">
  <app-shared-header [userType]="'doctor'" [userName]="doctorName"></app-shared-header>

  <main class="schedule-main">
    <!-- Page Header -->
    <section class="page-header">
      <div class="header-left">
        <h1 class="page-title">Appointment Schedule</h1>
        <p class="page-subtitle">Manage your daily appointments</p>
      </div>
    </section>

    <div class="schedule-layout">
      <!-- Main Column -->
      <div class="main-column">
        <!-- Date Navigation -->
        <div class="date-nav-card">
          <button class="nav-btn" (click)="previousDay()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"/>
            </svg>
          </button>
          <div class="current-date">
            <strong>{{ getFormattedCurrentDate() }}</strong>
            <span>{{ getAppointmentCountText() }}</span>
          </div>
          <button class="nav-btn" (click)="nextDay()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"/>
            </svg>
          </button>
          <button class="today-btn" (click)="goToToday()">Today</button>
        </div>

        <!-- Loading State -->
        <div class="loading-state" *ngIf="isLoading">
          <p>Loading appointments...</p>
        </div>

        <!-- Appointments List -->
        <div class="appointments-list" *ngIf="!isLoading">
          <!-- Show appointments if available -->
          <div class="appt-card" *ngFor="let appt of appointments">
            <div class="appt-time-section">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2" class="time-icon">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
              <div class="time-details">
                <strong class="appt-time">{{ appt.time }}</strong>
                <span class="appt-duration">{{ appt.duration }}</span>
              </div>
            </div>

            <div class="appt-details">
              <div class="patient-info">
                <div class="avatar">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                    <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                  </svg>
                </div>
                <div class="patient-details">
                  <h3 class="patient-name">{{ appt.patient }}</h3>
                  <p class="appt-type">{{ appt.type }}</p>
                </div>
              </div>
              <div class="appt-meta">
                <span class="status-badge" [class.confirmed]="appt.status === 'Confirmed'" [class.pending]="appt.status === 'Pending'">
                  <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" *ngIf="appt.status === 'Confirmed'">
                    <polyline points="20 6 9 17 4 12"/>
                  </svg>
                  <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" *ngIf="appt.status === 'Pending'">
                    <circle cx="12" cy="12" r="10"/>
                    <polyline points="12 6 12 12 16 14"/>
                  </svg>
                  {{ appt.status }}
                </span>
                <span class="mode-badge" [class.video]="appt.mode === 'Teleconsult'" [class.person]="appt.mode === 'In-Person'">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" *ngIf="appt.mode === 'Teleconsult'">
                    <path d="m22 8-6 4 6 4V8Z"/>
                    <rect width="14" height="12" x="2" y="6" rx="2" ry="2"/>
                  </svg>
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" *ngIf="appt.mode === 'In-Person'">
                    <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/>
                    <circle cx="12" cy="10" r="3"/>
                  </svg>
                  {{ appt.mode }}
                </span>
              </div>
            </div>

            <div class="appt-actions">
              <button class="btn-action view-btn" [routerLink]="['/doctor-patients', appt.patientId]">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/>
                  <circle cx="12" cy="12" r="3"/>
                </svg>
                View Patient
              </button>
              <button class="btn-action join-btn" *ngIf="appt.mode === 'Teleconsult' && appt.status === 'Confirmed'">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="m22 8-6 4 6 4V8Z"/>
                  <rect width="14" height="12" x="2" y="6" rx="2" ry="2"/>
                </svg>
                Join Call
              </button>
            </div>
          </div>

          <!-- Empty State -->
          <div class="empty-appointments" *ngIf="appointments.length === 0">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#cbd5e1" stroke-width="2">
              <rect width="18" height="18" x="3" y="4" rx="2" ry="2"/>
              <line x1="16" x2="16" y1="2" y2="6"/>
              <line x1="8" x2="8" y1="2" y2="6"/>
              <line x1="3" x2="21" y1="10" y2="10"/>
            </svg>
            <h3>No appointments scheduled</h3>
            <p>You have no appointments for this day</p>
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <aside class="sidebar">
        <!-- Weekly Overview -->
        <div class="weekly-card">
          <h3 class="card-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect width="18" height="18" x="3" y="4" rx="2" ry="2"/>
              <line x1="16" x2="16" y1="2" y2="6"/>
              <line x1="8" x2="8" y1="2" y2="6"/>
              <line x1="3" x2="21" y1="10" y2="10"/>
            </svg>
            Weekly Overview
          </h3>
          <div class="week-list">
            <div class="week-day" *ngFor="let day of weeklyStats">
              <div class="day-info">
                <strong>{{ day.day }}</strong>
                <small>{{ day.date }}</small>
              </div>
              <span class="count-badge">{{ day.count }} appointment{{ day.count !== 1 ? 's' : '' }}</span>
            </div>
          </div>
        </div>

        <!-- Quick Stats -->
        <div class="stats-card">
          <h3 class="card-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" x2="12" y1="20" y2="10"/>
              <line x1="18" x2="18" y1="20" y2="4"/>
              <line x1="6" x2="6" y1="20" y2="16"/>
            </svg>
            Quick Stats
          </h3>
          <div class="stats-list">
            <div class="stat-item">
              <span class="stat-label">Today's Total</span>
              <strong class="stat-value">{{ todayTotal }} appointment{{ todayTotal !== 1 ? 's' : '' }}</strong>
            </div>
            <div class="stat-item">
              <span class="stat-label">In-Person</span>
              <strong class="stat-value">{{ inPersonCount }}</strong>
            </div>
            <div class="stat-item">
              <span class="stat-label">Teleconsult</span>
              <strong class="stat-value">{{ teleconsultCount }}</strong>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </main>
</div>