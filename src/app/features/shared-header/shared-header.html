<!-- shared-header.html -->
<header class="dashboard-header">
  <div class="header-content">
    <div class="logo-section">
      <div class="logo-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white" stroke="white" stroke-width="2">
          <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/>
        </svg>
      </div>
      <span class="logo-text">Med-Connect</span>
    </div>
    
    <!-- Patient Navigation -->
    <nav class="main-nav" *ngIf="userType === 'patient'">
      <a routerLink="/patient-dashboard" routerLinkActive="active">Dashboard</a>
      <a routerLink="/medical-records" routerLinkActive="active">My Records</a>
      <a routerLink="/findDoctors" routerLinkActive="active">Find Doctors</a>
      <a routerLink="/appointment" routerLinkActive="active">Appointments</a>
    </nav>

    <!-- Doctor Navigation -->
    <nav class="main-nav" *ngIf="userType === 'doctor'">
      <a routerLink="/doctor-dashboard" routerLinkActive="active">Dashboard</a>
      <a routerLink="/doctor-patients" routerLinkActive="active">Patients</a>
      <a routerLink="/doctor-schedule" routerLinkActive="active">Schedule</a>
      <a routerLink="/doctor-messages" routerLinkActive="active">Messages</a>
    </nav>

    <div class="header-actions">
      <!-- Role Switcher (only if user has both roles) -->
      <div class="role-switcher-wrapper" *ngIf="userRoles.isPatient && userRoles.isDoctor">
        <button class="icon-btn role-switcher-btn" (click)="toggleRoleSwitcher()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
          </svg>
          <span class="role-text">{{ userType === 'patient' ? 'Patient' : 'Doctor' }}</span>
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"/>
          </svg>
        </button>

        <!-- Role Switcher Dropdown -->
        <div class="dropdown-menu" *ngIf="showRoleSwitcher">
          <div class="dropdown-header">
            <span class="dropdown-title">Switch Role</span>
          </div>
          <button 
            class="dropdown-item" 
            [class.active]="userType === 'patient'"
            (click)="switchRole('patient')">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
            <span>Patient View</span>
            <svg *ngIf="userType === 'patient'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2" style="margin-left: auto;">
              <polyline points="20 6 9 17 4 12"/>
            </svg>
          </button>
          <button 
            class="dropdown-item" 
            [class.active]="userType === 'doctor'"
            (click)="switchRole('doctor')">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
              <circle cx="9" cy="7" r="4"/>
              <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
            <span>Doctor View</span>
            <svg *ngIf="userType === 'doctor'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2" style="margin-left: auto;">
              <polyline points="20 6 9 17 4 12"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Notifications -->
      <div class="notification-wrapper">
        <button class="icon-btn notification-btn" (click)="toggleNotificationDropdown()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/>
            <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/>
          </svg>
          <span class="notification-badge" *ngIf="unreadCount > 0">{{ unreadCount }}</span>
        </button>

        <!-- Notification Dropdown -->
        <div class="dropdown-menu notification-dropdown" *ngIf="showNotificationDropdown">
          <div class="dropdown-header">
            <span class="dropdown-title">Notifications</span>
            <span class="notification-count" *ngIf="unreadCount > 0">{{ unreadCount }} new</span>
          </div>

          <div class="notifications-list" *ngIf="notifications.length > 0">
            <div 
              *ngFor="let notification of notifications" 
              class="notification-item"
              [class.unread]="!notification.isRead"
              (click)="markNotificationAsRead(notification)">
              
              <div class="notification-icon" [ngClass]="notification.type">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path [attr.d]="getNotificationIcon(notification.type)"/>
                </svg>
              </div>

              <div class="notification-content">
                <p class="notification-message">{{ notification.message }}</p>
                <span class="notification-time">{{ getTimeAgo(notification.createdAt) }}</span>

                <!-- Connection Request Actions (for doctors) -->
                <div class="notification-actions" *ngIf="notification.type === 'CONNECTION_REQUEST' && notification.relatedConnection?.status === 'pending'">
                  <button 
                    class="btn-accept" 
                    (click)="handleConnectionResponse(notification, 'accept'); $event.stopPropagation()">
                    Accept
                  </button>
                  <button 
                    class="btn-reject" 
                    (click)="handleConnectionResponse(notification, 'reject'); $event.stopPropagation()">
                    Decline
                  </button>
                </div>

                <!-- Appointment Request Actions (for doctors) -->
                <div class="notification-actions" *ngIf="notification.type === 'APPOINTMENT_REQUEST' && notification.relatedAppointment?.status === 'pending'">
                  <button 
                    class="btn-accept" 
                    (click)="handleAppointmentResponse(notification, 'accept'); $event.stopPropagation()">
                    Accept
                  </button>
                  <button 
                    class="btn-reject" 
                    (click)="handleAppointmentResponse(notification, 'reject'); $event.stopPropagation()">
                    Decline
                  </button>
                </div>
              </div>

              <div class="unread-indicator" *ngIf="!notification.isRead"></div>
            </div>
          </div>

          <div class="empty-notifications" *ngIf="notifications.length === 0">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#cbd5e1" stroke-width="2">
              <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/>
              <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/>
            </svg>
            <p>No notifications</p>
          </div>
        </div>
      </div>

      <!-- Profile Menu -->
      <div class="profile-menu-wrapper">
        <button class="icon-btn profile-btn" (click)="toggleProfileMenu()">
          <div class="avatar">
            <span>{{ userName.charAt(0).toUpperCase() }}</span>
          </div>
          <span class="user-name">{{ userName }}</span>
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"/>
          </svg>
        </button>

        <!-- Profile Dropdown -->
        <div class="dropdown-menu profile-dropdown" *ngIf="showProfileMenu">
          <div class="dropdown-header profile-header">
            <div class="profile-info">
              <div class="avatar-large">
                <span>{{ userName.charAt(0).toUpperCase() }}</span>
              </div>
              <div>
                <div class="profile-name">{{ userName }}</div>
                <div class="profile-role">{{ userType === 'patient' ? 'Patient' : 'Doctor' }}</div>
              </div>
            </div>
          </div>
          
          <div class="dropdown-divider"></div>
          
          <button class="dropdown-item" (click)="goToSettings()">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3"/>
              <path d="M12 1v6m0 6v6"/>
              <path d="m4.2 4.2 4.2 4.2m5.6 5.6 4.2 4.2"/>
              <path d="M1 12h6m6 0h6"/>
              <path d="m4.2 19.8 4.2-4.2m5.6-5.6 4.2-4.2"/>
            </svg>
            <span>Account Settings</span>
          </button>
          
          <div class="dropdown-divider"></div>
          
          <button class="dropdown-item logout-item" (click)="logout()">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
              <polyline points="16 17 21 12 16 7"/>
              <line x1="21" x2="9" y1="12" y2="12"/>
            </svg>
            <span>Logout</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Overlay to close menus when clicking outside -->
<div class="menu-overlay" *ngIf="showProfileMenu || showRoleSwitcher || showNotificationDropdown" (click)="closeMenus()"></div>